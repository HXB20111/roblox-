local WHITELIST = {
    [6039062907] = true,
    [7939421722] = true
}

local OrionLib
local success, err = pcall(function()
    OrionLib = loadstring(game:HttpGet("https://pastebin.com/raw/FUEx0f3G"))()
end)
if not success or not OrionLib then
    warn("Orion库加载失败: " .. (err or "未知错误"))
    return
end

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")
local StarterGui = game:GetService("StarterGui")
local player = Players.LocalPlayer

local isWhitelisted = WHITELIST[player.UserId] or false
if not isWhitelisted then
    pcall(function()
        StarterGui:SetCore("SendNotification", {
            Title = "未授权访问",
            Text = "您的ID不在白名单中，无法使用功能",
            Duration = 5,
            Icon = "rbxassetid://9108657181"
        })
    end)
    
    local RestrictWindow = OrionLib:MakeWindow({
        Name = "访问受限",
        HidePremium = false,
        SaveConfig = false,
        Theme = "Dark",
        Icon = "rbxassetid://9108657181"
    })
    local InfoTab = RestrictWindow:MakeTab({Name = "权限不足"})
    InfoTab:AddParagraph("提示", "请联系作者添加白名单")
    InfoTab:AddParagraph("您的ID", tostring(player.UserId))
    OrionLib:Init()
    return
end

local function makeRound(obj, radius)
    if not obj or not obj:IsA("GuiObject") then return end
    local corner = Instance.new("UICorner")
    corner.CornerRadius = radius or UDim.new(0.5, 0)
    corner.Parent = obj
    return corner
end

local Window = OrionLib:MakeWindow({
    Name = "新黄脚本",
    HidePremium = false,
    SaveConfig = true,
    IntroText = "新黄脚本 - 强大功能等你体验",
    ConfigFolder = "新黄脚本",
    Theme = "FlatBlue",
    Icon = "rbxassetid://4483345998"
})

pcall(function()
    StarterGui:SetCore("SendNotification", {
        Title = "新黄脚本",
        Text = "欢迎使用新黄脚本，功能已加载",
        Duration = 4,
        Icon = "rbxassetid://4483345998"
    })
end)

local AuthorTab = Window:MakeTab({
    Name = "作者信息",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

AuthorTab:AddParagraph("作者", "小黄")
AuthorTab:AddParagraph("作者QQ", "1357377308")
AuthorTab:AddParagraph("QQ群", "543121803")

local function addRoundButton(tab, config)
    local btn = tab:AddButton(config)
    if btn.Instance and btn.Instance:IsA("GuiButton") then
        btn.Instance.Size = UDim2.new(0, 120, 0, 36)
        makeRound(btn.Instance)
        
        local hover = Instance.new("UIScale")
        hover.Scale = 1
        hover.Parent = btn.Instance
        
        local enterConn = btn.Instance.MouseEnter:Connect(function()
            hover.Scale = 1.05
        end)
        local leaveConn = btn.Instance.MouseLeave:Connect(function()
            hover.Scale = 1
        end)
        
        btn.Instance.AncestryChanged:Connect(function(_, parent)
            if not parent then
                enterConn:Disconnect()
                leaveConn:Disconnect()
            end
        end)
    end
    return btn
end

addRoundButton(AuthorTab, {
    Name = "复制作者QQ",
    Callback = function()
        pcall(function()
            if setclipboard then
                setclipboard("1357377308")
                OrionLib:MakeNotification({Name = "成功", Content = "QQ已复制", Time = 2})
            else
                OrionLib:MakeNotification({Name = "错误", Content = "不支持复制功能", Time = 2})
            end
        end)
    end,
    Color = Color3.fromRGB(70, 130, 255)
})

addRoundButton(AuthorTab, {
    Name = "复制QQ群",
    Callback = function()
        pcall(function()
            if setclipboard then
                setclipboard("543121803")
                OrionLib:MakeNotification({Name = "成功", Content = "QQ群号已复制", Time = 2})
            else
                OrionLib:MakeNotification({Name = "错误", Content = "不支持复制功能", Time = 2})
            end
        end)
    end,
    Color = Color3.fromRGB(100, 200, 100)
})

local PlayerTab = Window:MakeTab({
    Name = "玩家信息",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

local executorName = "未知"
pcall(function()
    if identifyexecutor then
        executorName = identifyexecutor() or "未知"
    end
end)

PlayerTab:AddParagraph("您的用户名", player.Name)
PlayerTab:AddParagraph("您的ID", tostring(player.UserId))
PlayerTab:AddParagraph("注入器", executorName)
PlayerTab:AddParagraph("服务器ID", tostring(game.GameId))
PlayerTab:AddParagraph("白名单状态", "<font color='green'>已授权用户</font>")

local FunctionTab = Window:MakeTab({
    Name = "玩家功能",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

local MovementSection = FunctionTab:AddSection({Name = "移动设置"})

local function addSettingTextbox(tab, config)
    local textbox = tab:AddTextbox({
        Name = config.Name,
        Default = config.Default or "",
        TextDisappear = true,
        Callback = function(Value)
            local num = tonumber(Value)
            if not num or num <= 0 then  
                return OrionLib:MakeNotification({Name = "错误", Content = "请输入正数", Time = 2})
            end
            local success, err = pcall(config.Callback, num)
            if success then
                OrionLib:MakeNotification({Name = "成功", Content = config.SuccessMsg, Time = 1.5})
            else
                OrionLib:MakeNotification({Name = "错误", Content = "设置失败: " .. err, Time = 2})
            end
        end
    })
    
    task.delay(0.2, function()
        if textbox.Instance then
            local input = textbox.Instance:FindFirstChildOfClass("TextBox", true)  
            if input then
                makeRound(input, UDim.new(0.2, 0))
                local border = Instance.new("UIStroke")
                border.Color = Color3.new(0.7, 0.7, 0.7)
                border.Transparency = 0.8
                border.Thickness = 1
                border.Parent = input
            end
        end)
    end)
    return textbox
end

addSettingTextbox(FunctionTab, {
    Name = "跳跃高度设置",
    SuccessMsg = "跳跃高度已更新",
    Callback = function(num)
        local character = player.Character or player.CharacterAdded:Wait()
        local humanoid = character:FindFirstChildOfClass("Humanoid") 
        if not humanoid then
            humanoid = character:WaitForChild("Humanoid", 5)
        end
        if humanoid then
            humanoid.JumpPower = num
        else
            error("未找到人形对象（超时）")
        end
    end
})

addSettingTextbox(FunctionTab, {
    Name = "移动速度设置",
    SuccessMsg = "移动速度已更新",
    Callback = function(num)
        local character = player.Character or player.CharacterAdded:Wait()
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if not humanoid then
            humanoid = character:WaitForChild("Humanoid", 5)
        end
        if humanoid then
            humanoid.WalkSpeed = num
        else
            error("未找到人形对象（超时）")
        end
    end
})

addSettingTextbox(FunctionTab, {
    Name = "重力设置",
    SuccessMsg = "重力已更新",
    Callback = function(num)
        if num < 100 or num > 2000 then
            error("重力应在100-2000之间")
        end
        Workspace.Gravity = num
    end
})

local OtherSection = FunctionTab:AddSection({Name = "其他功能"})

local nightToggle = FunctionTab:AddToggle({
    Name = "夜视模式",
    Default = false,
    Callback = function(enabled)
        Lighting.Ambient = enabled and Color3.new(0.5, 0.5, 0.5) or Color3.new(0, 0, 0)
        Lighting.Brightness = enabled and 2 or 1
        OrionLib:MakeNotification({
            Name = enabled and "夜视开启" or "夜视关闭",
            Content = enabled and "环境亮度已提升" or "环境亮度已恢复",
            Time = 1.5
        })
    end,
    Color = Color3.fromRGB(255, 165, 0)
})

task.delay(0.2, function()
    if nightToggle.Instance then
        local switch = nightToggle.Instance:FindFirstChild("Switch", true)
        local handle = nightToggle.Instance:FindFirstChild("Handle", true)
        if switch then
            makeRound(switch, UDim.new(0.3, 0))
        end
        if handle then
            handle.Size = UDim2.new(0, 20, 0, 20)
            makeRound(handle)
        end
    end
end)

local HuangScriptTab = Window:MakeTab({
    Name = "黄脚本",
    Icon = "rbxassetid://4483345999",
    PremiumOnly = false
})

local EnhanceSection = HuangScriptTab:AddSection({Name = "角色增强"})

addSettingTextbox(HuangScriptTab, {
    Name = "自动回血速率",
    Default = "10",
    SuccessMsg = "回血速率已设置",
    Callback = function(num)
        if getgenv().RegenLoop then
            getgenv().RegenLoop:Disconnect()
        end
        getgenv().RegenLoop = RunService.Heartbeat:Connect(function()
            pcall(function()
                local humanoid = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
                if humanoid and humanoid.Health < humanoid.MaxHealth then
                    humanoid.Health = math.min(humanoid.Health + num, humanoid.MaxHealth)
                end
            end)
        end)
    end
})

local godmodeToggle = HuangScriptTab:AddToggle({
    Name = "无敌模式",
    Default = false,
    Callback = function(enabled)
        getgenv().IsGodmode = enabled
        if enabled then
            local humanoid = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                getgenv().OriginalMaxHealth = humanoid.MaxHealth
                humanoid.MaxHealth = 9999
                humanoid.Health = humanoid.MaxHealth
            end
            OrionLib:MakeNotification({Name = "无敌开启", Content = "已免疫伤害", Time = 2})
        else
            local humanoid = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
            if humanoid and getgenv().OriginalMaxHealth then
                humanoid.MaxHealth = getgenv().OriginalMaxHealth
                humanoid.Health = humanoid.MaxHealth
            end
            OrionLib:MakeNotification({Name = "无敌关闭", Content = "恢复正常状态", Time = 2})
        end
    end,
    Color = Color3.fromRGB(255, 0, 0)
})

local EnvSection = HuangScriptTab:AddSection({Name = "环境设置"})

addSettingTextbox(HuangScriptTab, {
    Name = "环境亮度",
    Default = "2",
    SuccessMsg = "亮度已调节",
    Callback = function(num)
        Lighting.Brightness = num
    end
})

local teleportToggle = HuangScriptTab:AddToggle({
    Name = "快速传送",
    Default = false,
    Callback = function(enabled)
        getgenv().TeleportEnabled = enabled
        OrionLib:MakeNotification({
            Name = enabled and "传送开启" or "传送关闭",
            Content = enabled and "点击地面快速传送" or "快速传送已禁用",
            Time = 2
        })
    end,
    Color = Color3.fromRGB(0, 255, 255)
})

game:GetService("UserInputService").InputBegan:Connect(function(input)
    if getgenv().TeleportEnabled and input.UserInputType == Enum.UserInputType.MouseButton1 then
        pcall(function()
            local mouse = player:GetMouse()
            local targetPos = mouse.Hit.Position
            local rootPart = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
            if rootPart then
                rootPart.CFrame = CFrame.new(targetPos + Vector3.new(0, 2, 0))
            end
        end)
    end
end)

task.delay(0.2, function()
    if godmodeToggle.Instance then
        local switch = godmodeToggle.Instance:FindFirstChild("Switch", true)
        local handle = godmodeToggle.Instance:FindFirstChild("Handle", true)
        if switch then makeRound(switch, UDim.new(0.3, 0)) end
        if handle then 
            handle.Size = UDim2.new(0, 20, 0, 20)
            makeRound(handle)
        end
    end
    if teleportToggle.Instance then
        local switch = teleportToggle.Instance:FindFirstChild("Switch", true)
        local handle = teleportToggle.Instance:FindFirstChild("Handle", true)
        if switch then makeRound(switch, UDim.new(0.3, 0)) end
        if handle then 
            handle.Size = UDim2.new(0, 20, 0, 20)
            makeRound(handle)
        end
    end
end)

local ScriptCenterTab = Window:MakeTab({
    Name = "脚本中心",
    Icon = "rbxassetid://4483346000",
    PremiumOnly = false
})

local isScriptLoading = false
addRoundButton(ScriptCenterTab, {
    Name = "皮脚本",
    Callback = function()
        if isScriptLoading then
            return OrionLib:MakeNotification({Name = "提示", Content = "加载中，请稍候...", Time = 2})
        end
        isScriptLoading = true
        OrionLib:MakeNotification({Name = "开始加载", Content = "正在加载皮脚本...", Time = 3})
        
        task.spawn(function()
            local success, err = pcall(function()
                getgenv().XiaoPi = "皮脚本QQ群1002100032"
                local scriptUrl = "https://raw.githubusercontent.com/xiaopi77/xiaopi77/main/QQ1002100032-Roblox-Pi-script.lua"
                loadstring(game:HttpGet(scriptUrl, true))() 
            end)
            isScriptLoading = false
            if success then
                OrionLib:MakeNotification({Name = "加载成功", Content = "皮脚本已加载完成！", Time = 3})
            else
                OrionLib:MakeNotification({Name = "加载失败", Content = "错误: " .. err, Time = 3})
            end
        end)
    end,
    Color = Color3.fromRGB(123, 104, 238)
})

OrionLib:Init()
task.delay(0.3, function()
    if Window.Instance then
        local mainFrame = Window.Instance:FindFirstChild("MainFrame", true)
        if mainFrame then
            makeRound(mainFrame, UDim.new(0.08, 0))
        end
    end
end)

local connections = {}

table.insert(connections, Players.PlayerRemoving:Connect(function(leavingPlayer)
    if leavingPlayer == player then
        for _, conn in ipairs(connections) do
            if conn and typeof(conn) == "RBXScriptConnection" then
                conn:Disconnect()
            end
        end
        if Window and Window.Instance then
            Window.Instance:Destroy()
        end
        Lighting.Ambient = Color3
        Lighting.Brightness = 1
        Workspace.Gravity = 196.2
    end
end))

table.insert(connections, Window.Instance:GetPropertyChangedSignal("Parent"):Connect(function()
    if not Window.Instance.Parent then
        for _, conn in ipairs(connections) do
            if conn and typeof(conn) == "RBXScriptConnection" then
                conn:Disconnect()
            end
        end
    end
end))
