-- 加载OrionLib库
local OrionLib
local success, err = pcall(function()
    OrionLib = loadstring(game:HttpGet("https://pastebin.com/raw/FUEx0f3G"))()
end)
if not success or not OrionLib then
    warn("Orion库加载失败: " .. (err or "未知错误"))
    return
end

-- 新黄名单系统配置
local StarterGui = game:GetService("StarterGui")
local Players = game:GetService("Players")
local WhitelistedPlayers = {
    ["FengY3"] = true,
    ["cn_bxf01"] = true,
    ["aaaadjdat"] = true,
    ["11451yuh"] = true,
    ["yesnopvp5"] = true,
    ["lzq261"] = true,
    ["HXB201111"] = true,
    ["123qwf658"] = true,
    ["zaqxswedc71"] = true,
    ["HPCEIAILUODIN"] = true,
    ["qwaszx123667"] = true,
    ["123456789wc91"] = true,
    ["SYTAAYY9178"] = true,
    ["wec524"] = true,
    ["sjjsensnje"] = true,
    ["years453"] = true,
    ["qaz123456789qazjk"] = true,
    ["91VIP11451411"] = true,
    ["Kicking881"] = true,
    ["131xne"] = true,
    ["KSTWGF_1"] = true,
    ["w64015"] = true,
    ["BRDDAAC"] = true,
    ["ggshsgg17"] = true,
    ["3166cs"] = true,
    ["sjwuxnshi"] = true,
    ["QLI_183a"] = true,
    ["Geburah_1"] = true,
    ["78917891wc"] = true,
    ["asxxxiod"] = true,
}

-- 黄名单检查函数
local function IsWhitelisted(player)
    return WhitelistedPlayers[player.Name] or false
end

-- 本地玩家验证
local localPlayer = Players.LocalPlayer
local isLocalPlayerWhitelisted = IsWhitelisted(localPlayer)

-- 黄名单验证结果处理
if isLocalPlayerWhitelisted then
    pcall(function()  -- 包裹SetCore调用，避免因游戏限制导致报错
        StarterGui:SetCore("SendNotification", {
            Title = "黄名单认证",
            Text = "玩家:" .. localPlayer.Name .. "，检测完毕黄名单玩家，稍后会加载脚本",
            Duration = 7,
        })
    end)
else
    localPlayer:Kick("你没有被加入黄名单，请加群543121803")
    return  -- 非黄名单玩家直接退出，不加载后续内容
end

-- 服务与变量初始化
local Lighting = game:GetService("Lighting")
local player = localPlayer  -- 已验证的本地玩家

-- 工具函数：创建圆角
local function makeRound(obj, radius)
    if obj and obj:IsA("GuiObject") then
        local corner = Instance.new("UICorner")
        corner.CornerRadius = radius or UDim.new(0.5, 0)
        corner.Parent = obj
    end
end

-- 创建主窗口
local Window = OrionLib:MakeWindow({
    Name = "新黄脚本",
    SaveConfig = true,
    IntroText = "新黄脚本 - 功能加载完成",
    Theme = "FlatBlue",
    Icon = "rbxassetid://118894209472715"
})

-- 欢迎通知
pcall(function()
    StarterGui:SetCore("SendNotification", {
        Title = "新黄脚本",
        Text = "欢迎使用，功能已就绪",
        Duration = 4,
        Icon = "rbxassetid://118894209472715"
    })
end)

-- 作者信息标签页
local AuthorTab = Window:MakeTab({Name = "作者信息", Icon = "rbxassetid://4483345998"})
AuthorTab:AddParagraph("作者", "Hfh916")
AuthorTab:AddParagraph("作者QQ", "1357377308")
AuthorTab:AddParagraph("QQ群", "543121803")
AuthorTab:AddParagraph("帮助者", "风御 X")
AuthorTab:AddParagraph("帮助者", "真的guiwow")

-- 圆形按钮生成器
local function addRoundButton(tab, config)
    local btn = tab:AddButton(config)
    if btn.Instance and btn.Instance:IsA("GuiButton") then
        btn.Instance.Size = UDim2.new(0, 120, 0, 36)
        makeRound(btn.Instance)
        
        local hover = Instance.new("UIScale")
        hover.Scale = 1
        hover.Parent = btn.Instance
        
        local enterConn = btn.Instance.MouseEnter:Connect(function() hover.Scale = 1.05 end)
        local leaveConn = btn.Instance.MouseLeave:Connect(function() hover.Scale = 1 end)
        
        btn.Instance.AncestryChanged:Connect(function(_, parent)
            if not parent then
                enterConn:Disconnect()
                leaveConn:Disconnect()
            end
        end)
    end
    return btn
end

-- 作者信息页按钮
addRoundButton(AuthorTab, {
    Name = "复制作者QQ",
    Callback = function()
        if setclipboard then
            setclipboard("1357377308")
            OrionLib:MakeNotification({Name = "成功", Content = "QQ已复制", Time = 2})
        end
    end,
    Color = Color3.fromRGB(70, 130, 255)
})

addRoundButton(AuthorTab, {
    Name = "复制QQ群",
    Callback = function()
        if setclipboard then
            setclipboard("543121803")
            OrionLib:MakeNotification({Name = "成功", Content = "QQ群已复制", Time = 2})
        end
    end,
    Color = Color3.fromRGB(100, 200, 100)
})

-- 玩家信息标签页
local PlayerTab = Window:MakeTab({Name = "玩家信息", Icon = "rbxassetid://4483345998"})
local executorName = "未知"
pcall(function() executorName = identifyexecutor() or "未知" end)

PlayerTab:AddParagraph("用户名", player.Name)
PlayerTab:AddParagraph("用户ID", tostring(player.UserId))
PlayerTab:AddParagraph("注入器", executorName)
PlayerTab:AddParagraph("服务器ID", tostring(game.GameId))
-- 显示当前玩家白名单状态
PlayerTab:AddParagraph("白名单状态", isLocalPlayerWhitelisted and "已授权" or "未授权")

-- 玩家功能标签页（含飞行功能）
local FunctionTab = Window:MakeTab({Name = "玩家功能", Icon = "rbxassetid://4483345998"})

-- 文本框配置函数
local function addSettingTextbox(tab, config)
    tab:AddTextbox({
        Name = config.Name,
        Callback = function(Value)
            local num = tonumber(Value)
            if not num or num <= 0 then
                return OrionLib:MakeNotification({Name = "错误", Content = "请输入正数", Time = 2})
            end
            local success, err = pcall(config.Callback, num)
            if not success then
                OrionLib:MakeNotification({Name = "错误", Content = "设置失败: " .. err, Time = 2})
            end
        end
    })
end

-- 移动设置
addSettingTextbox(FunctionTab, {
    Name = "跳跃高度",
    Callback = function(num)
        if not player.Character then
            error("角色不存在")
        end
        local humanoid = player.Character:WaitForChild("Humanoid", 5)
        if humanoid then
            humanoid.JumpPower = num
        else
            error("未找到Humanoid")
        end
    end
})

addSettingTextbox(FunctionTab, {
    Name = "移动速度",
    Callback = function(num)
        if not player.Character then
            error("角色不存在")
        end
        local humanoid = player.Character:WaitForChild("Humanoid", 5)
        if humanoid then
            humanoid.WalkSpeed = num
        else
            error("未找到Humanoid")
        end
    end
})

-- 相机焦距输入调节（输入后自动清空）
local function addCameraTextbox(tab, config)
    local textboxObj
    textboxObj = tab:AddTextbox({
        Name = config.Name,
        Placeholder = config.Placeholder,
        Callback = function(Value)
            local num = tonumber(Value)
            if not num or num < config.Min or num > config.Max then
                return OrionLib:MakeNotification({
                    Name = "错误", 
                    Content = "请输入" .. config.Min .. "-" .. config.Max .. "之间的数值", 
                    Time = 2
                })
            end
            -- 执行设置
            config.Callback(num)
            -- 显示成功通知
            OrionLib:MakeNotification({
                Name = "已调整", 
                Content = config.SuccessText .. num, 
                Time = 1.5
            })
            -- 清空输入框
            task.delay(0.1, function()
                if textboxObj and textboxObj.Instance then
                    local inputField = textboxObj.Instance:FindFirstChildOfClass("TextBox")
                    if inputField then
                        inputField.Text = ""
                    end
                end
            end)
        end
    })
end

-- 添加相机调节功能
addCameraTextbox(FunctionTab, {
    Name = "相机最大缩放距离",
    Placeholder = "输入数值（1-200000）",
    Min = 1,
    Max = 200000,
    SuccessText = "最大缩放距离: ",
    Callback = function(num)
        game.Players.LocalPlayer.CameraMaxZoomDistance = num
    end
})

addCameraTextbox(FunctionTab, {
    Name = "相机视野角度【正常70】",
    Placeholder = "输入数值（10-120）",
    Min = 10,
    Max = 120,
    SuccessText = "视野角度: ",
    Callback = function(num)
        workspace.CurrentCamera.FieldOfView = num
    end
})

-- 飞行功能
addRoundButton(FunctionTab, {
    Name = "飞行功能",
    Callback = function()
        OrionLib:MakeNotification({Name = "提示", Content = "正在加载飞行功能...", Time = 3})
        task.spawn(function()
            local success, err = pcall(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/HXB20111/roblox-/refs/heads/main/%E9%BB%84%E9%A3%9E%E8%A1%8C"))()
            end)
            if success then
                OrionLib:MakeNotification({Name = "成功", Content = "飞行功能加载完成", Time = 3})
            else
                OrionLib:MakeNotification({Name = "失败", Content = "加载错误: " .. err, Time = 3})
            end
        end)
    end,
    Color = Color3.fromRGB(135, 206, 235)
})

-- 夜视模式
FunctionTab:AddToggle({
    Name = "夜视模式",
    Default = false,
    Callback = function(enabled)
        Lighting.Ambient = enabled and Color3.new(0.5, 0.5, 0.5) or Color3.new(0, 0, 0)
        Lighting.Brightness = enabled and 2 or 1
    end,
    Color = Color3.fromRGB(255, 165, 0)
})

-- 穿墙模式
local Clipon = false
local Stepped

FunctionTab:AddToggle({
    Name = "穿墙模式",
    Default = false,
    Callback = function(enabled)
        Clipon = enabled
        local Workspace = game:GetService("Workspace")
        local Players = game:GetService("Players")
        
        -- 断开已有连接
        if Stepped then
            Stepped:Disconnect()
        end
        
        if enabled then
            -- 开启穿墙：禁用角色碰撞
            Stepped = game:GetService("RunService").Stepped:Connect(function()
                if Clipon then
                    local playerChar = Workspace:FindFirstChild(Players.LocalPlayer.Name)
                    if playerChar then
                        for _, part in pairs(playerChar:GetChildren()) do
                            if part:IsA("BasePart") then
                                part.CanCollide = false
                            end
                        end
                    end
                else
                    Stepped:Disconnect()
                end
            end)
            OrionLib:MakeNotification({Name = "成功", Content = "穿墙模式已开启", Time = 2})
        else
            -- 关闭穿墙：恢复碰撞
            local playerChar = Workspace:FindFirstChild(Players.LocalPlayer.Name)
            if playerChar then
                for _, part in pairs(playerChar:GetChildren()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = true
                    end
                end
            end
            OrionLib:MakeNotification({Name = "提示", Content = "穿墙模式已关闭", Time = 2})
        end
    end,
    Color = Color3.fromRGB(100, 149, 237)
})

-- 透视功能
FunctionTab:AddToggle({
    Name = "透视",
    Default = false,
    Callback = function(enabled)
        if enabled then
            -- 加载透视功能
            pcall(function()
            loadstring(game:HttpGet('https://raw.githubusercontent.com/Lucasfin000/SpaceHub/main/UESP'))()
                OrionLib:MakeNotification({Name = "成功", Content = "透视功能已开启", Time = 2})
            end)
        else
            -- 尝试关闭透视（根据实际实现补充关闭逻辑）
            -- 若原透视脚本有卸载函数，可在此调用，示例：
            -- if typeof(StopESP) == "function" then StopESP() end
            OrionLib:MakeNotification({Name = "提示", Content = "透视功能已关闭", Time = 2})
        end
    end,
    Color = Color3.fromRGB(128, 0, 128) -- 紫色标识
})

credits:Textbox("旋转速度", "SpinSpeed", "输入", function(Value)
    local speed = tonumber(Value)
    local plr = game:GetService("Players").LocalPlayer
    repeat task.wait() until plr.Character
    local humRoot = plr.Character:WaitForChild("HumanoidRootPart")
    local humanoid = plr.Character:WaitForChild("Humanoid")
    humanoid.AutoRotate = false

    if not spinVelocity then
        spinVelocity = Instance.new("AngularVelocity")
        spinVelocity.Attachment0 = humRoot:WaitForChild("RootAttachment")
        spinVelocity.MaxTorque = math.huge
        spinVelocity.AngularVelocity = Vector3.new(0, speed, 0)
        spinVelocity.Parent = humRoot
        spinVelocity.Name = "Spinbot"
    else
        spinVelocity.AngularVelocity = Vector3.new(0, speed, 0)
    end
end)

credits:Button("停止旋转", function()
    local plr = game:GetService("Players").LocalPlayer
    repeat task.wait() until plr.Character
    local humRoot = plr.Character:WaitForChild("HumanoidRootPart")
    local humanoid = plr.Character:WaitForChild("Humanoid")

    local spinbot = humRoot:FindFirstChild("Spinbot")
    if spinbot then
        spinbot:Destroy()
        spinVelocity = nil
    end
    humanoid.AutoRotate = true 
end)
  
local ScriptCenterTab = Window:MakeTab({
    Name = "脚本区",
    Icon = "rbxassetid://4483345998"})

ScriptCenterTab:AddButton({
    Name = "彩虹朋友",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/JNHHGaming/Rainbow-Friends/main/Rainbow%20Friends"))()
    end
})

ScriptCenterTab:AddButton({
    Name = "力量传奇",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/harisiskandar178/Roblox-Script/main/Muscle%20Legend"))()
    end
})

ScriptCenterTab:AddButton({
    Name = "造船寻宝",
    Callback = function()
        loadstring(game:HttpGet("https://pastebin.com/raw/Lyy77rnr",true))()
    end
})

local ScriptCenterTab = Window:MakeTab({Name = "优秀脚本", Icon = "rbxassetid://4483345998"})

addRoundButton(ScriptCenterTab, {
    Name = "加载皮脚本",
    Callback = function()
        OrionLib:MakeNotification({Name = "提示", Content = "正在加载...", Time = 3})
        task.spawn(function()
            local success, err = pcall(function()
                getgenv().XiaoPi = "皮脚本QQ群1002100032"
                loadstring(game:HttpGet("https://raw.githubusercontent.com/xiaopi77/xiaopi77/main/QQ1002100032-Roblox-Pi-script.lua", true))()
            end)
            if success then
                OrionLib:MakeNotification({Name = "成功", Content = "加载完成", Time = 3})
            else
                OrionLib:MakeNotification({Name = "失败", Content = "错误: " .. err, Time = 3})
            end
        end)
    end,
    Color = Color3.fromRGB(123, 104, 238)
})

-- 导管中心
addRoundButton(ScriptCenterTab, {
    Name = "加载导管脚本",
    Callback = function()
        OrionLib:MakeNotification({Name = "提示", Content = "正在加载导管中心...", Time = 3})
        task.spawn(function()
            local success, err = pcall(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/useranewrff/roblox-/main/%E7%AE%A1%E7%AE%80%E5%8D%E8%A3%E8%81%94"))()
            end)
            if success then
                OrionLib:MakeNotification({Name = "成功", Content = "导管中心加载完成", Time = 3})
            else
                OrionLib:MakeNotification({Name = "失败", Content = "错误: " .. err, Time = 3})
            end
        end)
    end,
    Color = Color3.fromRGB(255, 99, 71)
})

-- 落叶中心
addRoundButton(ScriptCenterTab, {
    Name = "加载落叶脚本",
    Callback = function()
        OrionLib:MakeNotification({Name = "提示", Content = "正在加载落叶脚本...", Time = 3})
        task.spawn(function()
            local success, err = pcall(function()
                getgenv().LS = "落叶脚本"
                loadstring(game:HttpGet("https://raw.githubusercontent.com/krlpl/Deciduous-center-LS/main/%E8%90%BD%E5%8F%B6%E4%B8%AD%E5%BF%83%E6%B7%B7%E6%B7%86.txt"))()
            end)
            if success then
                OrionLib:MakeNotification({Name = "成功", Content = "落叶脚本加载完成", Time = 3})
            else
                OrionLib:MakeNotification({Name = "失败", Content = "错误: " .. err, Time = 3})
            end
        end)
    end,
    Color = Color3.fromRGB(139, 69, 19)
})

-- 霖溺-免费版加载器
addRoundButton(ScriptCenterTab, {
    Name = "加载霖溺脚本",
    Callback = function()
        OrionLib:MakeNotification({Name = "提示", Content = "正在加载霖溺-免费版加载器...", Time = 3})
        task.spawn(function()
            local success, err = pcall(function()
                getgenv().LnScript = "霖溺-免费版加载器"
                loadstring(game:HttpGet("https://raw.githubusercontent.com/ShenJiaoBen/ScriptLoader/refs/heads/main/Linni_FreeLoader.lua"))()
            end)
            if success then
                OrionLib:MakeNotification({Name = "成功", Content = "霖溺-免费版加载器加载完成", Time = 3})
            else
                OrionLib:MakeNotification({Name = "失败", Content = "错误: " .. err, Time = 3})
            end
        end)
    end,
    Color = Color3.fromRGB(70, 200, 200)
})

-- 叶脚本
addRoundButton(ScriptCenterTab, {
    Name = "加载叶脚本",
    Callback = function()
        OrionLib:MakeNotification({Name = "提示", Content = "正在加载叶脚本...", Time = 3})
        task.spawn(function()
            local success, err = pcall(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/roblox-ye/QQ515966991/refs/heads/main/ROBLOX-CNVIP-XIAOYE.lua"))()
            end)
            if success then
                OrionLib:MakeNotification({Name = "成功", Content = "叶脚本加载完成", Time = 3})
            else
                OrionLib:MakeNotification({Name = "失败", Content = "错误: " .. err, Time = 3})
            end
        end)
    end,
    Color = Color3.fromRGB(123, 200, 91)
})

-- 刹脚本
addRoundButton(ScriptCenterTab, {
    Name = "加载刹脚本",
    Callback = function()
        OrionLib:MakeNotification({Name = "提示", Content = "正在加载刹🗡脚本...", Time = 3})
        task.spawn(function()
            local success, err = pcall(function()
                getgenv().FwngYu = "殺脚本 QQ群819104139"
                loadstring(game:HttpGet("https://raw.githubusercontent.com/FengYu-3/FengY4/refs/heads/main/shascript.lua"))()
            end)
            if success then
                OrionLib:MakeNotification({Name = "成功", Content = "刹🗡脚本加载完成", Time = 3})
            else
                OrionLib:MakeNotification({Name = "失败", Content = "错误: " .. err, Time = 3})
            end
        end)
    end,
    Color = Color3.fromRGB(200, 70, 70)
})

-- 鬼脚本
addRoundButton(ScriptCenterTab, {
    Name = "加载鬼脚本",
    Callback = function()
        OrionLib:MakeNotification({Name = "提示", Content = "正在加载鬼脚本...", Time = 3})
        task.spawn(function()
            local success, err = pcall(function()
                getgenv().GHOST_SCRIPT = "GHOST_TEAM"
                loadstring(game:HttpGet("https://raw.githubusercontent.com/Ghost-Gui-888/Ghost-Script/main/GHOST-TEAM.lua", true))()
            end)
            if success then
                OrionLib:MakeNotification({Name = "成功", Content = "鬼脚本加载完成", Time = 3})
            else
                OrionLib:MakeNotification({Name = "失败", Content = "错误: " .. err, Time = 3})
            end
        end)
    end,
    Color = Color3.fromRGB(105, 105, 105)
})

addRoundButton(ScriptCenterTab, {
    Name = "加载汉化脚本",
    Callback = function()
        OrionLib:MakeNotification({Name = "提示", Content = "正在加载汉化脚本...", Time = 3})
        task.spawn(function()
            local success, err = pcall(function()
                getgenv().GHOST_SCRIPT = "QQ群654441319"
                loadstring(game:HttpGet('https://raw.githubusercontent.com/S-WTB/-/refs/heads/main/ISIS加载器'))()
            end)
            if success then
                OrionLib:MakeNotification({Name = "成功", Content = "汉化脚本加载完成", Time = 3})
            else
                OrionLib:MakeNotification({Name = "失败", Content = "错误: " .. err, Time = 3})
            end
        end)
    end,
    Color = Color3.fromRGB(255, 78, 91)
})

addRoundButton(ScriptCenterTab, {
    Name = "加载KG脚本",
    Callback = function()
        OrionLib:MakeNotification({Name = "提示", Content = "正在加载KG脚本...", Time = 3})
        task.spawn(function()
            local success, err = pcall(function()
                getgenv().GHOST_SCRIPT = "鬼和风御制作"
                loadstring(game:HttpGet("https://raw.githubusercontent.com/520-Ghost/-/refs/heads/main/KG.lua"))()
            end)
            if success then
                OrionLib:MakeNotification({Name = "成功", Content = "KG脚本加载完成", Time = 3})
            else
                OrionLib:MakeNotification({Name = "失败", Content = "错误: " .. err, Time = 3})
            end
        end)
    end,
    Color = Color3.fromRGB(255, 78, 91)
})

-- 初始化界面
OrionLib:Init()

-- 样式优化
task.delay(0.3, function()
    local mainFrame = Window.Instance:FindFirstChild("MainFrame", true)
    if mainFrame then
        makeRound(mainFrame, UDim.new(0.08, 0))
    end
end)

-- 清理函数
local function cleanUp()
    if Window and Window.Instance then
        Window.Instance:Destroy()
    end
    Lighting.Ambient = Color3.new(0, 0, 0)
    Lighting.Brightness = 1
end
