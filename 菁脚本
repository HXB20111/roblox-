-- 白名单系统核心配置
local WHITELIST = {
    [12345678] = true, -- 替换为允许的用户ID
    [87654321] = true,
    [1357377308] = true -- 示例：作者ID
}

-- 加载UI库（白名单验证前的基础加载）
local OrionLib
local success, err = pcall(function()
    OrionLib = loadstring(game:HttpGet("https://pastebin.com/raw/FUEx0f3G"))()
end)
if not success or not OrionLib then
    warn("UI库加载失败: " .. (err or "未知错误"))
    return
end

-- 服务初始化
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")
local StarterGui = game:GetService("StarterGui")

-- 检查用户是否在白名单内
local isWhitelisted = WHITELIST[player.UserId] or false

-- 白名单验证提示
local function showWhitelistMessage(isAllowed)
    StarterGui:SetCore("SendNotification", {
        Title = isAllowed and "验证通过" or "未授权访问",
        Text = isAllowed and "您已获得使用权限" or "您的ID不在白名单内，无法使用功能",
        Duration = 5,
        Icon = isAllowed and "rbxassetid://4483345998" or "rbxassetid://9108657181"
    })
end

-- 如果不在白名单，仅显示提示界面
if not isWhitelisted then
    showWhitelistMessage(false)
    
    -- 创建限制访问的提示窗口
    local RestrictWindow = OrionLib:MakeWindow({
        Name = "未授权访问",
        HidePremium = false,
        SaveConfig = false,
        Theme = "Dark",
        Icon = "rbxassetid://9108657181"
    })
    
    local InfoTab = RestrictWindow:MakeTab({
        Name = "访问受限",
        Icon = "rbxassetid://9108657181"
    })
    
    InfoTab:AddParagraph("权限不足", "您的账号未被授权使用此脚本")
    InfoTab:AddParagraph("您的ID", tostring(player.UserId))
    InfoTab:AddParagraph("提示", "请联系管理员添加白名单")
    
    OrionLib:Init()
    return -- 终止后续功能加载
end

-- 白名单用户加载完整功能
showWhitelistMessage(true)

-- 工具函数：创建圆角效果
local function makeRound(obj, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = radius or UDim.new(0.05, 0)
    corner.Parent = obj
    return corner
end

-- 创建主窗口
local Window = OrionLib:MakeWindow({
    Name = "Roblox 多功能脚本",
    HidePremium = false,
    SaveConfig = true,
    ConfigFolder = "RobloxScript",
    Theme = "Dark",
    Icon = "rbxassetid://4483345998"
})

-- 1. 玩家信息标签页
local PlayerTab = Window:MakeTab({
    Name = "玩家信息",
    Icon = "rbxassetid://6034775432",
    PremiumOnly = false
})

-- 玩家信息卡片（包含白名单状态）
local infoCard = Instance.new("Frame")
infoCard.Size = UDim2.new(1, -20, 0, 200)
infoCard.Position = UDim2.new(0, 10, 0, 10)
infoCard.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
infoCard.BorderSizePixel = 0
makeRound(infoCard)
infoCard.Parent = PlayerTab.Frame

-- 头像显示
local avatar = Instance.new("ImageLabel")
avatar.Size = UDim2.new(0, 80, 0, 80)
avatar.Position = UDim2.new(0.5, 0, 0, 15)
avatar.AnchorPoint = Vector2.new(0.5, 0)
avatar.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
avatar.Image = "https://www.roblox.com/Thumbs/Avatar.ashx?x=100&y=100&username="..player.Name
makeRound(avatar, UDim.new(0.5, 0)) -- 圆形头像
avatar.Parent = infoCard

-- 信息文本
local function addInfoText(text, yPos, isHighlighted)
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0, 20)
    label.Position = UDim2.new(0, 0, 0, yPos)
    label.BackgroundTransparency = 1
    label.TextColor3 = isHighlighted and Color3.new(0, 1, 0) or Color3.new(0.9, 0.9, 0.9)
    label.Text = text
    label.TextXAlignment = Enum.TextXAlignment.Center
    label.TextSize = 14
    label.Parent = infoCard
    return label
end

addInfoText("用户名: "..player.Name, 100)
addInfoText("用户ID: "..player.UserId, 125)
addInfoText("服务器: "..game.JobId:sub(1, 8).."...", 150)
addInfoText("[已授权] 白名单用户", 175, true) -- 显示白名单状态

-- 2. 角色功能标签页
local CharacterTab = Window:MakeTab({
    Name = "角色功能",
    Icon = "rbxassetid://6034775432",
    PremiumOnly = false
})

-- 移动设置区域
local MovementSection = CharacterTab:AddSection({Name = "移动控制"})

CharacterTab:AddSlider({
    Name = "移动速度",
    Min = 16,
    Max = 200,
    Default = 16,
    Increment = 1,
    Callback = function(Value)
        if player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
            player.Character.Humanoid.WalkSpeed = Value
        end
    end
})

CharacterTab:AddSlider({
    Name = "跳跃高度",
    Min = 50,
    Max = 500,
    Default = 50,
    Increment = 10,
    Callback = function(Value)
        if player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
            player.Character.Humanoid.JumpPower = Value
        end
    end
})

-- 开关功能区
local ToggleSection = CharacterTab:AddSection({Name = "特殊功能"})

-- 夜视模式
CharacterTab:AddToggle({
    Name = "夜视模式",
    Default = false,
    Callback = function(Value)
        Lighting.Ambient = Value and Color3.new(0.5, 0.5, 0.5) or Color3.new(0, 0, 0)
        Lighting.Brightness = Value and 2 or 1
    end
})

-- 3. 白名单管理标签页（仅白名单用户可见）
local WhitelistTab = Window:MakeTab({
    Name = "白名单管理",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

WhitelistTab:AddParagraph("当前白名单", "仅管理员可修改白名单配置")

-- 显示当前白名单列表
local whitelistList = "已授权用户ID:\n"
for userId in pairs(WHITELIST) do
    whitelistList ..= "- " .. tostring(userId) .. "\n"
end
WhitelistTab:AddParagraph("列表", whitelistList)

-- 添加白名单功能（示例：实际使用时可添加权限验证）
local addWhitelistBox = WhitelistTab:AddTextbox({
    Name = "添加用户到白名单",
    Default = "输入用户ID",
    TextDisappear = true,
    Callback = function(Value)
        local userId = tonumber(Value)
        if userId then
            WHITELIST[userId] = true
            OrionLib:MakeNotification({
                Name = "成功",
                Content = "用户 " .. userId .. " 已添加到白名单",
                Time = 2
            })
        else
            OrionLib:MakeNotification({
                Name = "错误",
                Content = "请输入有效的用户ID",
                Time = 2
            })
        end
    end
})

-- 4. 快捷功能标签页
local QuickTab = Window:MakeTab({
    Name = "快捷功能",
    Icon = "rbxassetid://6034775432",
    PremiumOnly = false
})

QuickTab:AddButton({
    Name = "重生角色",
    Callback = function()
        player:LoadCharacter()
        OrionLib:MakeNotification({
            Name = "成功",
            Content = "角色已重生",
            Time = 2
        })
    end
})

-- UI美化处理
task.delay(0.3, function()
    -- 主窗口圆角
    local mainFrame = Window.Instance:FindFirstChild("MainFrame")
    if mainFrame then
        makeRound(mainFrame, UDim.new(0.05, 0))
    end
    
    -- 按钮美化
    for _, btn in pairs(Window.Instance:GetDescendants()) do
        if btn:IsA("TextButton") and btn.Name ~= "Close" then
            makeRound(btn)
            local originalColor = btn.BackgroundColor3
            btn.MouseEnter:Connect(function()
                btn.BackgroundColor3 = originalColor:Lerp(Color3.new(0.5, 0.5, 0.5), 0.3)
            end)
            btn.MouseLeave:Connect(function()
                btn.BackgroundColor3 = originalColor
            end)
        end
    end
end)

-- 初始化UI
OrionLib:Init()
