-- 引入必要服务
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer

-- 确保在客户端运行
if not player then
    error("代码必须放在 LocalScript 中（客户端运行）")
end

-- 等待PlayerGui加载（带超时处理）
local playerGui = player:WaitForChild("PlayerGui", 10)
if not playerGui then
    error("PlayerGui加载超时，请检查脚本位置")
end

-- 创建或复用UI容器
local screenGui = playerGui:FindFirstChild("PlayerInfoUI") or Instance.new("ScreenGui")
screenGui.Name = "PlayerInfoUI"
screenGui.Parent = playerGui

-- 清除旧UI元素（避免重复显示）
for _, child in ipairs(screenGui:GetChildren()) do
    child:Destroy()
end

-- 主背景框架
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 450, 0, 220)  -- 适中的尺寸
mainFrame.Position = UDim2.new(0.5, -225, 0.1, 0)  -- 居中显示
mainFrame.BackgroundColor3 = Color3.fromRGB(48, 173, 168)  -- 主体青绿色
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

-- 左侧白色竖线
local leftLine = Instance.new("Frame")
leftLine.Name = "LeftLine"
leftLine.Size = UDim2.new(0, 2, 0, 150)  -- 竖线高度
leftLine.Position = UDim2.new(0, 70, 0.1, 0)  -- 竖线位置
leftLine.BackgroundColor3 = Color3.fromRGB(255, 255, 255)  -- 白色线条
leftLine.BorderSizePixel = 0
leftLine.Parent = mainFrame

-- 底部白色横线
local bottomLine = Instance.new("Frame")
bottomLine.Name = "BottomLine"
bottomLine.Size = UDim2.new(0, 430, 0, 2)  -- 横线宽度适配主框架
bottomLine.Position = UDim2.new(0, 10, 0.65, 0)  -- 横线位置
bottomLine.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
bottomLine.BorderSizePixel = 0
bottomLine.Parent = mainFrame

-- 玩家头像（圆形，动态获取）
local function createPlayerAvatar()
    local avatarFrame = Instance.new("ImageLabel")
    avatarFrame.Name = "PlayerAvatar"
    avatarFrame.Size = UDim2.new(0, 60, 0, 60)  -- 头像大小
    avatarFrame.Position = UDim2.new(0, 5, 0.7, 0)  -- 头像位置（靠近底部）
    avatarFrame.BorderSizePixel = 0
    avatarFrame.Parent = mainFrame

    -- 圆形裁剪
    local uiCorner = Instance.new("UICorner")
    uiCorner.CornerRadius = UDim.new(1, 0)  -- 完全圆形
    uiCorner.Parent = avatarFrame

    -- 加载玩家头像（带错误处理）
    local success, content, isReady = pcall(function()
        return Players:GetUserThumbnailAsync(
            player.UserId,
            Enum.ThumbnailType.HeadShot,
            Enum.ThumbnailSize.Size420x420
        )
    end)

    if success and isReady then
        avatarFrame.Image = content
    else
        warn("头像加载失败：" .. (content or "未知错误"))
        avatarFrame.Image = "rbxassetid://3926305904"  -- 默认头像
    end
end
createPlayerAvatar()

-- 彩色玩家名字标签（核心效果）
local userNameLabel = Instance.new("TextLabel")
userNameLabel.Name = "UserNameLabel"
userNameLabel.Size = UDim2.new(0, 180, 0, 30)  -- 足够宽度避免文字截断
userNameLabel.Position = UDim2.new(0, 80, 0.7, 0)  -- 与头像对齐
userNameLabel.Text = player.Name  -- 显示玩家真实名字
userNameLabel.Font = Enum.Font.SourceSansBold
userNameLabel.TextSize = 22  -- 稍大字体突出显示
userNameLabel.BackgroundColor3 = Color3.fromRGB(150, 150, 150)  -- 灰色背景
userNameLabel.BorderSizePixel = 0
userNameLabel.Parent = mainFrame

-- 彩色文字动画（彩虹渐变效果）
local function startRainbowEffect(label)
    local hue = 0
    while label.Parent do  -- 标签存在时循环
        hue = (hue + 1) % 360  -- 色相循环（0-359）
        label.TextColor3 = Color3.fromHSV(hue / 360, 1, 1)  -- HSV转RGB
        task.wait(0.1)  -- 颜色切换速度
    end
end
task.spawn(startRainbowEffect, userNameLabel)  -- 异步启动动画

-- 注入器名字标签（动态获取）
local function getInjectorName()
    -- 实际场景中替换为真实获取逻辑（示例：从配置文件读取）
    -- 例如：return game.ReplicatedStorage.InjectorConfig.Name.Value
    return "UltraInjector X5"  -- 示例名字
end

local injectorLabel = Instance.new("TextLabel")
injectorLabel.Name = "InjectorLabel"
injectorLabel.Size = UDim2.new(0, 150, 0, 25)
injectorLabel.Position = UDim2.new(0, 200, 0.65, 0)  -- 位于用户名右侧
injectorLabel.Text = "注入器: " .. getInjectorName()  -- 显示注入器名字
injectorLabel.TextColor3 = Color3.fromRGB(255, 255, 255)  -- 白色文字
injectorLabel.Font = Enum.Font.SourceSans
injectorLabel.TextSize = 18
injectorLabel.BackgroundColor3 = Color3.fromRGB(150, 150, 150)
injectorLabel.BorderSizePixel = 0
injectorLabel.Parent = mainFrame

-- 用户ID标签
local userIDLabel = Instance.new("TextLabel")
userIDLabel.Name = "UserIDLabel"
userIDLabel.Size = UDim2.new(0, 120, 0, 25)
userIDLabel.Position = UDim2.new(0, 200, 0.78, 0)  -- 在注入器名字下方
userIDLabel.Text = "ID: " .. tostring(player.UserId)  -- 显示玩家ID
userIDLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
userIDLabel.Font = Enum.Font.SourceSans
userIDLabel.TextSize = 18
userIDLabel.BackgroundColor3 = Color3.fromRGB(150, 150, 150)
userIDLabel.BorderSizePixel = 0
userIDLabel.Parent = mainFrame

-- 右侧图片区域
local imageArea = Instance.new("ImageLabel")
imageArea.Name = "ImageArea"
imageArea.Size = UDim2.new(0, 80, 0, 50)  -- 图片区域大小
imageArea.Position = UDim2.new(0, 370, 0.68, 0)  -- 右侧位置
imageArea.Image = "rbxassetid://10427444644"  -- 示例图片（可替换）
imageArea.BackgroundColor3 = Color3.fromRGB(200, 200, 200)  -- 浅灰背景
imageArea.BorderSizePixel = 0
imageArea.Parent = mainFrame

-- 图片区域文字说明
local imageText = Instance.new("TextLabel")
imageText.Name = "ImageText"
imageText.Size = UDim2.new(0, 80, 0, 20)
imageText.Position = UDim2.new(0, 370, 0.63, 0)  -- 图片上方
imageText.Text = "状态图"
imageText.TextColor3 = Color3.fromRGB(255, 255, 255)
imageText.Font = Enum.Font.SourceSans
imageText.TextSize = 16
imageText.BackgroundTransparency = 1  -- 透明背景
imageText.Parent = mainFrame
